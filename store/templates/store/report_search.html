{% extends "store/base.html" %}
{% block title %}Office Issue Report{% endblock %}

{% block content %}
<div class="container py-4">
    <h2 class="mb-4 text-center">Office Issue Report</h2>

    <!-- Search Form -->
    <form method="get" class="row g-3 mb-4">
        <div class="col-md-3">
            <label>Start Date</label>
            <input type="date" name="start_date" class="form-control" value="{{ start_date }}">
        </div>
        <div class="col-md-3">
            <label>End Date</label>
            <input type="date" name="end_date" class="form-control" value="{{ end_date }}">
        </div>
        <div class="col-md-3">
            <label>Office</label>
            <select name="office" class="form-select">
                <option value="">All Offices</option>
                {% for office in offices %}
                    <option value="{{ office.id }}" {% if office.id|stringformat:"s" == selected_office %}selected{% endif %}>
                        {{ office.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <label>Item</label>
            <input type="text" name="query" class="form-control" placeholder="Search item..." value="{{ query }}">
        </div>
        <div class="col-md-1 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Search</button>
        </div>
    </form>

    {% if report %}
    <div class="d-flex justify-content-end mb-3">
        <button onclick="window.print()" class="btn btn-secondary">Print</button>
    </div>

    <!-- Detailed Report Table -->
    <div id="print-area">
        <table class="table table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th>Date Issued</th>
                    <th>Office</th>
                    <th>Item</th>
                    <th>Total Quantity</th>
                </tr>
            </thead>
            <tbody>
                {% for row in report %}
                <tr>
                    <td>{{ row.date_issued }}</td>
                    <td>{{ row.office__name }}</td>
                    <td>{{ row.stock_item__name }}</td>
                    <td>{{ row.total_quantity }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

    </div>
    {% else %}
        <div class="alert alert-warning text-center">No matching results found.</div>
    {% endif %}
</div>

<!-- Print CSS -->
<style>
@media print {
    body * {
        visibility: hidden;
    }
    #print-area, #print-area * {
        visibility: visible;
    }
    #print-area {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
    }
}
</style>
{% endblock %}
