{% extends "store/base.html" %}
{% block title %}Office Issue Report{% endblock %}

{% block content %}
<div class="container py-4">
    <h2 class="mb-4 text-center">Office Issue Report</h2>

    <form method="get" class="row g-3 mb-4">
        <div class="col-md-3">
            <label>Start Date</label>
            <input type="date" name="start_date" class="form-control" value="{{ start_date }}">
        </div>
        <div class="col-md-3">
            <label>End Date</label>
            <input type="date" name="end_date" class="form-control" value="{{ end_date }}">
        </div>
        <div class="col-md-3">
            <label>Office</label>
            <select name="office" class="form-select">
                <option value="">All Offices</option>
                {% for office in offices %}
                    <option value="{{ office.id }}" {% if office.id|stringformat:"s" == selected_office %}selected{% endif %}>
                        {{ office.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <label>Item</label>
            <input type="text" name="query" class="form-control" placeholder="Search item..." value="{{ query }}">
        </div>
        <div class="col-md-1 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Search</button>
        </div>
    </form>

    {% if report %}
    <div class="d-flex justify-content-end mb-3 gap-2">
        <button onclick="window.print()" class="btn btn-secondary">Print</button>
        <a href="{% url 'export_pdf' %}?start_date={{ start_date }}&end_date={{ end_date }}&office={{ selected_office }}&query={{ query }}" class="btn btn-success">Export PDF</a>
    </div>

    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>Office</th>
                <th>Item</th>
                <th>Total Quantity</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in report %}
            <tr>
                <td>{{ entry.office__name }}</td>
                <td>{{ entry.stock_item__name }}</td>
                <td>{{ entry.total_quantity }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <div class="alert alert-warning">No matching results found.</div>
    {% endif %}
</div>
{% endblock %}
