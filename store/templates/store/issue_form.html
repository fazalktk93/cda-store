{% extends 'store/base.html' %}
{% load static %}

{% block content %}
<form method="post">
    {% csrf_token %}
    <div class="form-group">
        <label for="id_stock_item">Stock item:</label>
        {{ form.stock_item }}
        <span id="remainingQtyLabel" style="margin-left: 10px; font-weight: bold;"></span>
    </div>

    <div class="form-group">
        <label for="id_office">Office:</label>
        {{ form.office }}
    </div>

    <div class="form-group">
        <label for="id_quantity_issued">Quantity issued:</label>
        {{ form.quantity_issued }}
    </div>

    <div class="form-group">
        <label for="id_remarks">Remarks:</label>
        {{ form.remarks }}
    </div>

    <div class="form-group">
        <label for="id_date_issued">Date issued:</label>
        {{ form.date_issued }}
    </div>

    <button type="submit" class="btn btn-primary">Save</button>
</form>

<script>
    const stockData = {{ stock_data_json|safe }};

    document.addEventListener('DOMContentLoaded', function () {
        const dropdown = document.getElementById('id_stock_item');
        const label = document.getElementById('remainingQtyLabel');

        function updateLabel() {
            const selectedId = dropdown.value;
            const qty = stockData[selectedId];
            label.textContent = qty !== undefined ? `Remaining: ${qty}` : '';
        }

        dropdown.addEventListener('change', updateLabel);
        updateLabel();
    });
</script>
{% endblock %}
{% if issued_items %}
<hr>
<h4>Recently Issued Items</h4>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Stock Item</th>
            <th>Office</th>
            <th>Quantity</th>
            <th>Date Issued</th>
            <th>Remarks</th>
        </tr>
    </thead>
    <tbody>
        {% for issue in issued_items %}
        <tr>
            <td>{{ issue.stock_item.name }}</td>
            <td>{{ issue.office.name }}</td>
            <td>{{ issue.quantity_issued }}</td>
            <td>{{ issue.date_issued }}</td>
            <td>{{ issue.remarks }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}
